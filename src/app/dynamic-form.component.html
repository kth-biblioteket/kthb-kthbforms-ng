<!-- Laddningsikon att visa vid exvis apianrop-->
<div *ngIf="loading" class="loading">
  <img class="loading-image" src="{{loaderurl}}" alt="Loading..." />
</div>
<!-- Inforruta, OK svar från API-->
<div *ngIf="backendresponse && backendresult && !warning" class="alert alert-success">
    <div class="">
      <h4>
        {{language=='swedish' ? formdata.postresponseinfo.header.swedish : formdata.postresponseinfo.header.english}}
      </h4>
      <div>
        {{language=='swedish' ? formdata.postresponseinfo.text.swedish : formdata.postresponseinfo.text.english}}
      </div>
    </div>
</div>
<!-- Varning -->
<div *ngIf="backendresponse && warning" class="alert alert-info">
  <div class="">
    <div class="">
      <h4>
        {{language=='swedish' ? formdata.postresponseinfo.header.swedish : formdata.postresponseinfo.header.english}}
      </h4>
      <div>
        {{language=='swedish' ? formdata.postresponseinfo.text.swedish : formdata.postresponseinfo.text.english}}
      </div>
    </div>
    <div>
        <h4>
          {{language=='swedish' ? formdata.posterrorresponseinfo.header.swedish : formdata.posterrorresponseinfo.header.english}}
        </h4>
        <div>
          {{backendresulterror}}
        </div>
    </div>
  </div>
</div>
<!-- Fel! -->
<div *ngIf="backendresponse && !backendresult" class="alert alert-danger">
  <div class="">
    <div class="">
      <h4>
        {{language=='swedish' ? formdata.posterrorresponseinfo.header.swedish : formdata.posterrorresponseinfo.header.english}}
      </h4>
      <div>
        {{language=='swedish' ? formdata.posterrorresponseinfo.text.swedish : formdata.posterrorresponseinfo.text.english}}
      </div>
    </div>
    <div>
      {{backendresulterror}}
    </div>
  </div>
</div>
<!-- Eventuellt meddelande om att fält är ogilitga/inte ifyllda -->
<div class="">
  <div *ngIf="showtoperrormessage && kthbform.invalid" class="alert alert-danger">
    <div class="">
      <h4>
        {{language=='swedish' ? formdata.invalidforminfo.header.swedish : formdata.invalidforminfo.header.english}}
      </h4>
      <div>
        {{language=='swedish' ? formdata.invalidforminfo.text.swedish : formdata.invalidforminfo.text.english}}
      </div>
    </div>
  </div>
</div>
<!-- Om formuläret initierats -->
<div *ngIf="formisinit">
    <!-- Informationstext/Beskrivning -->
    <div *ngIf="formstatus=='closed'" style="margin-bottom:15px">
      {{language=='swedish' ? formdescription.closed.swedish : formdescription.closed.english}}
    </div>
    <div *ngIf="formstatus=='open'">
      <div *ngIf="formdescription.open.swedish!='' && formdescription.open.english!=''" style="margin-bottom:15px">
        {{language=='swedish' ? formdescription.open.swedish : formdescription.open.english}}
      </div>
      <!-- Formuläret -->
      <div id="form_body">
        <!-- OpenUrl-ruta -->
        <div *ngIf="isopenurl">
          <label>{{language=='swedish' ? openurlboxlabel.swedish : openurlboxlabel.english}}</label>
          <div class="card">
            <div class="card-body">
              <div *ngFor="let parameter of objectFormfields">                
                <div *ngIf="parameter.openurl">
                  <div *ngIf="openurljson[parameter.openurlnames['standard']] != null && openurljson[parameter.openurlnames['standard']] != '' && parameter.key=='genre' ">
                    <strong>{{language=='swedish' ? parameter.label.swedish: parameter.label.english}}:</strong> {{language=='swedish' ? formdata.genrenames[openurljson[parameter.openurlnames['standard']]].swedish : formdata.genrenames[openurljson[parameter.openurlnames['standard']]].english }}
                  </div>
                  <div *ngIf="openurljson[parameter.openurlnames['standard']] != null && openurljson[parameter.openurlnames['standard']] != '' && parameter.key!='genre' ">
                    <strong>{{language=='swedish' ? parameter.label.swedish: parameter.label.english}}:</strong> {{ openurljson[parameter.openurlnames['standard']] }}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <form novalidate (ngSubmit)="onSubmit(kthbform.value)" [formGroup]="kthbform">
          <!-- Om det är en grupperingslabel så ta bort margin -->
          <div [ngStyle]="prop.type =='grouplabel' ? {'margin-bottom':'0px'} : {'margin-bottom':'15px'}" *ngFor="let prop of objectFormfields">
            <div *ngIf="prop.enabled && !prop.hidden">
              <!-- Label för varje fält, inte fet stil om fält ingår i gruppering, visa inte för checkbox och informationbox -->
              <label *ngIf="prop.type != 'checkbox' && prop.type!='informationbox'" [ngClass]="{'isgrouped': prop.isgrouped, 'isnotgrouped': !prop.isgrouped }" [attr.for]="prop.key">
                {{language=='swedish' ? prop.label.swedish : prop.label.english}}
                <!-- Fält valfritt? -->
                <span style="font-style:italic;font-weight:normal">
                  {{!prop.validation.required.value && language=='swedish' ? '(' + optionalfieldtext.swedish + ')': ''}}{{!prop.validation.required.value && language=='english' ? '(' + optionalfieldtext.english + ')' : ''}}
                </span>
              </label>
              <!-- Felmeddelanden vid ogiltigt/inte ifyllt -->
              <!--div class="error" *ngIf="kthbform.get(prop.key).invalid && (kthbform.get(prop.key).dirty || kthbform.get(prop.key).touched)"-->
              <div class="error" *ngIf="formsubmitted && kthbform.get(prop.key).invalid">
                <div *ngIf="kthbform.get(prop.key).errors.required">
                  {{language=='swedish' ? prop.label.swedish : prop.label.english}} {{ language=='swedish' ? prop.validation.required.errormessage.swedish : prop.validation.required.errormessage.english }}
                </div>
                <div *ngIf="kthbform.get(prop.key).errors.pattern">
                  {{language=='swedish' ? prop.label.swedish : prop.label.english}} {{ language=='swedish' ? prop.validation.pattern.errormessage.swedish : prop.validation.pattern.errormessage.english }}
                </div>
              </div>
              <!-- Om placement=before -->
              <!-- Eventuell extra information/beskrivning-->
              <div *ngIf="prop.description && prop.description.placement=='before'">
                  {{language=='swedish' ? prop.description.swedish : prop.description.english}}
              </div>
              <!-- Eventuell länk-->
              <div style="margin-bottom:10px" *ngIf="prop.link && prop.link.placement=='before'">
                  <a target="_new" href="{{language=='swedish' ? prop.link.swedish.url : prop.link.english.url}}">
                      {{language=='swedish' ? prop.link.swedish.text : prop.link.english.text}}
                  </a>
              </div>
              <!-- Fälten -->
              <div [ngSwitch]="prop.type">
                <!-- Vanlig textruta -->
                <input style="margin-top:0px;" class="form-control medium" *ngSwitchCase="'text'" 
                  [formControlName]="prop.key"
                  [id]="prop.key" [type]="prop.type">
                
                <!-- Password textruta -->
                <input style="margin-top:0px;" class="form-control medium" *ngSwitchCase="'password'" 
                  [formControlName]="prop.key"
                  [id]="prop.key" [type]="prop.type">
                
                <!-- Datum inputruta -->
                <div *ngSwitchCase="'datebox'" class="datebox" styale="display:flex; flex-direction: row;">
                  <my-date-picker [options]="myDatePickerOptions" [formControlName]="prop.key" locale="{{language=='swedish' ? 'sv' : 'en'}}"></my-date-picker>
                </div>

                <!-- Meddelanderuta -->
                <div *ngSwitchCase="'textarea'">
                  <textarea class="form-control medium" [formControlName]="prop.key" [id]="prop.key"></textarea>
                </div>
                
                <!-- Använd grupperingsfält som label for checkbox -->
                <div *ngSwitchCase="'checkbox'">
                    <label style="margin-top:0px;font-weight: normal;">
                      <input (change)="checkboxchange(prop.key)"
                        type="checkbox"
                        [name]="prop.key"
                        [formControlName]="prop.key"
                        [value]=""> {{language=='swedish' ? prop.label.swedish : prop.label.english}}
                    </label>
                </div>
                
                <!-- Radio -->
                <div *ngSwitchCase="'radio'">
                  <div *ngFor="let option of prop.options">
                    <!-- Visa inte de alternativ som har egenskap "hidden": true -->
                    <label style="margin-top:0px;font-weight: normal;" *ngIf="option.enabled && !option.hidden">
                      <div *ngIf="option.link">
                        <input type="radio" value="option.value" (change)="changelocation(option.link)"> {{language=='swedish' ? option.label.swedish : option.label.english}}
                      </div>
                      <div *ngIf="!option.link">
                        <input (change)="onchangeformobject(this,prop.key,$event)"
                          type="radio"
                          [name]="prop.key"
                          [formControlName]="prop.key"
                          [value]="option.value"> {{language=='swedish' ? option.label.swedish : option.label.english}}
                      </div>
                    </label>
                  </div>
                </div>
                
                <!-- Select -->
                <div *ngSwitchCase="'select'">
                  <select [formControlName]="prop.key">
                    <option *ngFor="let option of prop.options" [value]="option.value">
                      {{ language=='swedish' ? option.label.swedish : option.label.english}}
                    </option>
                  </select>
                </div>
              </div
              >
              <!-- Om placement=after -->
              <div [ngClass]="{'alert alert-info': prop.type=='informationbox' }" [ngStyle]="prop.type=='informationbox' ? {'position': 'relative'} : {}">
                  <!-- Eventuell extra information/beskrivning-->
                  <div *ngIf="prop.description && prop.description.placement=='after'">
                      {{language=='swedish' ? prop.description.swedish : prop.description.english}}
                  </div>
                  <!-- Eventuell länk-->
                  <div style="margin-bottom:10px" *ngIf="prop.link && prop.link.placement=='after'">
                      <a target="_new" href="{{language=='swedish' ? prop.link.swedish.url : prop.link.english.url}}">
                          {{language=='swedish' ? prop.link.swedish.text : prop.link.english.text}}
                      </a>
                  </div>
                </div>
            </div>          
          </div>
          <!-- Skickaknapp -->
          <div class="controls">
            <!--input [disabled]="!form.valid" class="form-control btn-success" type="submit" value="Skicka" -->
            <input class="form-control btn-success" type="submit" value="Skicka">
          </div>
        </form>
        <div>
      <div>
    </div>  
    <!-- Nedan endast för development -->
    <div *ngIf="!isprod">
      <div style="clear:both">
      <br/>
      <strong>Formulärvärden</strong>
      <pre>{{ kthbform.value | json }}</pre>
      <pre>{{ openurljson | json }}</pre>
      <strong>Formulär är giltigt:</strong> {{kthbform.valid}}
      </div>
    </div>